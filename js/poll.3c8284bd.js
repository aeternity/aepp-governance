(self["webpackChunkgovernance_aepp"]=self["webpackChunkgovernance_aepp"]||[]).push([[239],{20640:function(e,t,a){"use strict";var o=a(25108),s=a(11742),l={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function i(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}function r(e,t){var a,r,c,d,p,u,h=!1;t||(t={}),a=t.debug||!1;try{c=s(),d=document.createRange(),p=document.getSelection(),u=document.createElement("span"),u.textContent=e,u.ariaHidden="true",u.style.all="unset",u.style.position="fixed",u.style.top=0,u.style.clip="rect(0, 0, 0, 0)",u.style.whiteSpace="pre",u.style.webkitUserSelect="text",u.style.MozUserSelect="text",u.style.msUserSelect="text",u.style.userSelect="text",u.addEventListener("copy",(function(s){if(s.stopPropagation(),t.format)if(s.preventDefault(),"undefined"===typeof s.clipboardData){a&&o.warn("unable to use e.clipboardData"),a&&o.warn("trying IE specific stuff"),window.clipboardData.clearData();var n=l[t.format]||l["default"];window.clipboardData.setData(n,e)}else s.clipboardData.clearData(),s.clipboardData.setData(t.format,e);t.onCopy&&(s.preventDefault(),t.onCopy(s.clipboardData))})),document.body.appendChild(u),d.selectNodeContents(u),p.addRange(d);var g=document.execCommand("copy");if(!g)throw new Error("copy command was unsuccessful");h=!0}catch(m){a&&o.error("unable to copy using execCommand: ",m),a&&o.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),h=!0}catch(m){a&&o.error("unable to copy using clipboardData: ",m),a&&o.error("falling back to prompt"),r=i("message"in t?t.message:n),window.prompt(r,e)}}finally{p&&("function"==typeof p.removeRange?p.removeRange(d):p.removeAllRanges()),u&&document.body.removeChild(u),c()}return h}e.exports=r},11742:function(e){e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,a=[],o=0;o<e.rangeCount;o++)a.push(e.getRangeAt(o));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||a.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},20164:function(e,t,a){"use strict";a.d(t,{Z:function(){return j}});var o=a(66252),s=a(3577),l=a(49963),n=a.p+"img/copy.96784235.svg",i=a.p+"img/open_arrow.d453c5f3.svg";const r=e=>((0,o.dD)("data-v-6e17f07a"),e=e(),(0,o.Cn)(),e),c={class:"mx-4 mt-2 ae-card"},d={key:0,class:"absolute flex inset-0 justify-center items-center bg-primary z-20"},p=r((()=>(0,o._)("span",null,"Copied address to clipboard",-1))),u=[p],h={class:"flex justify-between items-center mt-2"},g={key:0},m={class:"flex justify-between items-center mt-3"},y={key:0,class:"text-sm font-bold font-mono ml-auto"},f={key:1,class:"w-5"},v={key:0,class:"flex justify-between items-center my-3"},w=r((()=>(0,o._)("div",{class:"text-xs opacity-90 leading-tight flex-1"},[(0,o.Uk)(" Estimated delegated stake "),(0,o._)("br"),(0,o.Uk)(" Delegators votes can overwrite delegation ")],-1))),k={class:"text-sm font-bold font-mono ml-auto text-right"},b={key:0,class:"w-5"},C={key:1,class:"flex justify-between items-center my-3"},x=r((()=>(0,o._)("div",{class:"text-xs opacity-90 leading-tight"}," Could not fetch information about delegated stake. ",-1))),_=[x],D={class:"flex justify-between items-center"},S=r((()=>(0,o._)("div",{class:"text-xs opacity-90 leading-tight font-bold"}," Estimated voting power ",-1))),O={key:0,class:"text-sm font-bold font-mono ml-auto leading-tight mt-1"},A=r((()=>(0,o._)("img",{src:i,class:"w-full",alt:"show voting power"},null,-1))),T=[A];function V(e,t,a,i,r,p){const x=(0,o.up)("AeIdentityLight");return(0,o.wg)(),(0,o.iD)("div",c,[((0,o.wg)(),(0,o.iD)("div",{class:(0,s.C_)(["bg-primary px-3 w-full text-2xl text-white relative rounded-t ae-max-height-0 overflow-hidden ae-transition-300",{"ae-max-height-40":r.open}]),key:a.address},[(0,o.Wm)(l.uT,{name:"fade"},{default:(0,o.w5)((()=>[r.showCopyNotice?((0,o.wg)(),(0,o.iD)("div",d,u)):(0,o.kq)("",!0)])),_:1}),(0,o._)("div",h,[(0,o._)("span",null,[r.isOwnAccount?((0,o.wg)(),(0,o.iD)("span",g,"Your ")):(0,o.kq)("",!0),(0,o.Uk)(" Account")]),(0,o._)("img",{src:n,class:"w-4 h-4 text-white cursor-pointer",onClick:t[0]||(t[0]=(...e)=>p.copyToClipboard&&p.copyToClipboard(...e)),alt:"copy"})]),(0,o._)("div",m,[(0,o._)("div",null,[(0,o.Wm)(x,{collapsed:!0,balance:"",address:a.address,class:"text-white",invert:!0,onClick:p.copyToClipboard},null,8,["address","onClick"])]),null!==r.balance?((0,o.wg)(),(0,o.iD)("div",y,(0,s.zw)(p.toAE(r.balance)),1)):(0,o.kq)("",!0),a.canOpen?((0,o.wg)(),(0,o.iD)("div",f)):(0,o.kq)("",!0)]),r.delegatedPower?((0,o.wg)(),(0,o.iD)("div",v,[w,(0,o._)("div",k,(0,s.zw)(p.toAE(r.delegatedPower)),1),a.canOpen?((0,o.wg)(),(0,o.iD)("div",b)):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("div",C,_))],2)),(0,o._)("div",{class:(0,s.C_)(["bg-ae-purple text-white pl-3 pr-2 py-2 rounded-b",{"rounded-t":!r.open,"pr-3":!a.canOpen}])},[(0,o._)("div",D,[S,r.totalStake?((0,o.wg)(),(0,o.iD)("div",O,(0,s.zw)(p.toAE(r.totalStake)),1)):(0,o.kq)("",!0),a.canOpen?((0,o.wg)(),(0,o.iD)("div",{key:1,class:(0,s.C_)(["w-5 flex justify-center items-center ml-2 ae-transition-300",{"rotate-90":r.open}]),onClick:t[1]||(t[1]=e=>r.open=!r.open)},T,2)):(0,o.kq)("",!0)])],2)])}var B=a(45468),P=a(81251),F=a(10237),L=a(70794),q=a(20640),Z=a.n(q),z=a(16395),U=a(25108),E={name:"AccountHeader",components:{AeIdentityLight:B.Z},props:{address:{type:String,default:"",required:!0},pollAddress:{type:String,default:null},startOpen:{type:Boolean,default:!0},canOpen:{type:Boolean,default:!0}},data(){return{balance:null,delegatedPower:null,totalStake:null,isOwnAccount:!1,showCopyNotice:!1,open:!0}},methods:{toAE:z.zx,async loadData(){P.gU.isStatic||(this.isOwnAccount=P.gU.walletAddress===this.address),this.balance=await P.SZ.getBalance(this.address),await new F.Z(P.gU.networkId).delegatedPower(this.address,this.pollAddress).then((e=>{null===e?this.totalStake=new L.Z(this.balance):(this.delegatedPower=e.delegatedPower,this.totalStake=new L.Z(this.balance).plus(this.delegatedPower))})).catch((e=>{U.error(e),this.totalStake=new L.Z(this.balance)}))},copyToClipboard(){Z()(this.address),this.showCopyNotice=!0,setTimeout((()=>{this.showCopyNotice=!1}),1500)}},watch:{address(){this.loadData()}},created(){this.eventBus.on("dataChange",this.loadData),this.loadData(),this.open=this.startOpen},beforeUnmount(){this.eventBus.off("dataChange",this.loadData)}},N=a(83744);const I=(0,N.Z)(E,[["render",V],["__scopeId","data-v-6e17f07a"]]);var j=I},11758:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var o=a(66252);const s={class:"mx-4 mb-4 mt-2 p-4 bg-gray-200 text-gray-600 text-sm ae-triangle-after"};function l(e,t,a,l,n,i){return(0,o.wg)(),(0,o.iD)("div",s,[(0,o.WI)(e.$slots,"default",{},void 0,!0)])}var n={name:"HintBubble"},i=a(83744);const r=(0,i.Z)(n,[["render",l],["__scopeId","data-v-7ca5dc6e"]]);var c=r},6447:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Le}});a(57658);var o=a(66252),s=a(49963),l=a(3577),n=a(35584),i=a(76705);const r=e=>((0,o.dD)("data-v-0dd4ee95"),e=e(),(0,o.Cn)(),e),c={class:"overlay-loader"},d={key:0},p={key:1,class:"text-center"},u=r((()=>(0,o._)("div",{class:"text-gray-500 mt-4"},"POLL CLOSED",-1))),h=[u],g={class:"flex justify-between mx-4 mt-4 mb-2"},m={class:"max-w-75"},y={class:"text-3xl leading-tight w-full break-words"},f={class:"h-8 flex items-center vote-id justify-end"},v=r((()=>(0,o._)("img",{class:"h-full",src:n,alt:"hash"},null,-1))),w={class:"text-primary text-4xl leading-none"},k={class:"text-gray-500 mx-4 font-xl",id:"poll-description"},b={class:"text-gray-500 mx-4 py-2 font-xl relative"},C=["href"],x={key:0,class:"absolute inset-0 bg-gray-500 text-white p-2 rounded"},_={class:"mx-4 my-2 flex",id:"poll-author"},D=r((()=>(0,o._)("span",{class:"text-sm mr-1 text-gray-500"},"BY:",-1))),S={class:"text-primary"},O=(0,o.uE)('<div class="relative h-4 w-full" data-v-0dd4ee95><div class="absolute inset-0 flex h-full w-full justify-center items-center px-4" data-v-0dd4ee95><div class="border w-full" data-v-0dd4ee95></div></div><div class="absolute inset-0 flex h-full w-full justify-center items-center" data-v-0dd4ee95><div class="bg-ae-gray px-2" data-v-0dd4ee95><span class="text-gray-500 opacity-75" data-v-0dd4ee95>POLL</span></div></div></div>',1),A={class:"text-center w-full mt-2 text-gray-500 text-sm"},T={key:0,class:"inline-block"},V={key:1,class:"inline-block"},B={key:2},P={key:3},F={key:4},L={id:"poll-options"},q={key:0},Z={key:0},z={key:1},U={key:2},E={key:3},N={key:4},I=["onClick"],j={class:"flex justify-between items-center w-full py-4 px-3"},$={class:"mr-auto ml-2",style:{"margin-top":"4px"}},R={key:0,class:"font-bold"},H={key:0,class:"min-w-3",style:{"margin-top":"4px"}},W={class:"text-gray-500 text-sm mx-4"},Y={key:0,class:"text-gray-500 text-sm my-1 mx-2"},M=r((()=>(0,o._)("div",{class:"relative h-4 mt-6 w-full"},[(0,o._)("div",{class:"absolute inset-0 flex h-full w-full justify-center items-center px-4"},[(0,o._)("div",{class:"border w-full"})])],-1))),K={class:"text-center w-full mt-1 text-xs relative"},G={class:"opacity-40"},J={key:0,class:"inset-0 absolute bg-gray-500 text-white h-8 p-2"};function X(e,t,a,n,r,u){const X=(0,o.up)("BiggerLoader"),Q=(0,o.up)("AccountHeader"),ee=(0,o.up)("ae-identity-light"),te=(0,o.up)("HintBubble"),ae=(0,o.up)("ae-check"),oe=(0,o.up)("AccountTreeLine"),se=(0,o.up)("BottomButtons"),le=(0,o.up)("CriticalErrorOverlay");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.wy)((0,o._)("div",c,[(0,o.Wm)(X)],512),[[s.F8,r.showLoading&&!r.error]]),r.pollState.metadata?((0,o.wg)(),(0,o.iD)("div",d,[e.wallet.address&&!r.isClosed?((0,o.wg)(),(0,o.j4)(Q,{key:0,class:"mb-4",address:e.wallet.address,"poll-address":r.pollAddress,startOpen:!1,canOpen:!0},null,8,["address","poll-address"])):(0,o.kq)("",!0),r.isClosed?((0,o.wg)(),(0,o.iD)("div",p,h)):(0,o.kq)("",!0),(0,o._)("div",g,[(0,o._)("div",m,[(0,o._)("h1",y,(0,l.zw)(r.pollState.metadata.title),1)]),(0,o._)("div",f,[v,(0,o._)("span",w,(0,l.zw)(r.pollId),1)])]),(0,o._)("div",k,(0,l.zw)(r.pollState.metadata.description),1),(0,o._)("div",b,[(0,o._)("a",{href:r.pollState.metadata.link,onClick:t[0]||(t[0]=(0,s.iM)(((...e)=>u.openLink&&u.openLink(...e)),["stop","prevent"])),class:"text-blue-500 opacity-75"},(0,l.zw)(r.pollState.metadata.link),9,C),(0,o.Wm)(s.uT,{name:"fade"},{default:(0,o.w5)((()=>[r.showCopyNotice?((0,o.wg)(),(0,o.iD)("div",x," Copied link to clipboard ")):(0,o.kq)("",!0)])),_:1})]),(0,o._)("div",_,[D,(0,o._)("div",S,[(0,o.Wm)(ee,{collapsed:!0,balance:"",address:r.pollState.author,onClick:t[1]||(t[1]=t=>e.$router.push(`/account/${r.pollState.author}`))},null,8,["address"])])]),O,(0,o._)("div",A,[r.pollVotesState&&r.pollVotesState.totalStake?((0,o.wg)(),(0,o.iD)("div",T," Stake: "+(0,l.zw)(u.toAE(r.pollVotesState.totalStake))+" ("+(0,l.zw)(u.formatPercent(r.pollVotesState.percentOfTotalSupply,2))+") ",1)):(0,o.kq)("",!0),"number"!==typeof r.pollState.close_height?((0,o.wg)(),(0,o.iD)("div",V," - Closes never ")):r.isClosed?r.isClosed&&r.closeBlock?((0,o.wg)(),(0,o.iD)("div",P," Closed on "+(0,l.zw)(u.closeBlockTimeString)+" (Block "+(0,l.zw)(r.pollState.close_height)+") ",1)):r.isClosed&&!r.closeBlock?((0,o.wg)(),(0,o.iD)("div",F," Closed at block "+(0,l.zw)(r.pollState.close_height),1)):(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",B," Closes in ~"+(0,l.zw)(u.timeDifferenceString)+" (Block "+(0,l.zw)(r.pollState.close_height)+") ",1))]),(0,o._)("div",L,[r.pollState.vote_options?((0,o.wg)(),(0,o.iD)("div",q,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.pollState.vote_options,(([a,n])=>((0,o.wg)(),(0,o.iD)("div",{key:a},[r.delegateeVote&&r.delegateeVote.option===a?((0,o.wg)(),(0,o.j4)(te,{key:0},{default:(0,o.w5)((()=>[(0,o.Uk)(" Your "),Object.keys(r.delegateeVote.delegationTree).includes(e.wallet.address)?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",Z,"sub-")),(0,o.Uk)("delegatee "),(0,o._)("a",{class:"font-mono text-primary text-xs",href:"#",onClick:t[2]||(t[2]=(0,s.iM)((t=>e.$router.push(`/account/${r.delegateeVote.account}`)),["stop","prevent"]))},(0,l.zw)(r.delegateeVote.account.substr(0,12))+" ••• ",1),r.isClosed?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",z,"has")),r.isClosed?((0,o.wg)(),(0,o.iD)("span",U,"had")):(0,o.kq)("",!0),(0,o.Uk)(' voted with your stake for "'+(0,l.zw)(n)+'"',1),r.isClosed?((0,o.wg)(),(0,o.iD)("span",E," at the time the poll closed")):(0,o.kq)("",!0),(0,o.Uk)(". "),r.isClosed?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",N,"Unhappy? You can overwrite their choice by placing your own vote."))])),_:2},1024)):(0,o.kq)("",!0),(0,o._)("div",{class:"m-4 ae-card cursor-pointer",onClick:e=>u.showVoters(a)},[(0,o._)("div",j,[(0,o.Wm)(ae,{class:"mr-1",checked:r.voteOption,value:a,type:"radio",onChange:(0,s.iM)((e=>u.vote(a)),["self"]),disabled:r.isClosed||!e.wallet.address},null,8,["checked","value","onChange","disabled"]),(0,o._)("div",$,[r.pollVotesState?((0,o.wg)(),(0,o.iD)("span",R,(0,l.zw)(u.formatPercent(r.pollVotesState.stakesForOption[a].percentageOfTotal)),1)):(0,o.kq)("",!0),(0,o._)("span",null," "+(0,l.zw)(n),1)]),r.pollVotesState?((0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("img",{src:i,class:(0,l.C_)(["ae-transition-300",{"rotate-90":null!=r.votersForOption.id&&r.votersForOption.id===a}]),alt:"show poll state"},null,2)])):(0,o.kq)("",!0)]),r.pollVotesState?((0,o.wg)(),(0,o.iD)("div",{key:0,class:(0,l.C_)(["h-1 bg-primary rounded-bl",{"rounded-br":r.pollVotesState.stakesForOption[a].percentageOfTotal>99}]),style:(0,l.j5)({width:`${r.pollVotesState.stakesForOption[a].percentageOfTotal}%`})},null,6)):(0,o.kq)("",!0)],8,I),(0,o.wy)((0,o._)("div",W,[r.pollVotesState?((0,o.wg)(),(0,o.iD)("div",Y,(0,l.zw)(u.formatPercent(r.pollVotesState.stakesForOption[a].percentageOfTotal,2))+" ("+(0,l.zw)(u.toAE(r.pollVotesState.stakesForOption[a].optionStake))+") - "+(0,l.zw)(r.pollVotesState.stakesForOption[a].votes.length)+" Votes - "+(0,l.zw)(r.pollVotesState.stakesForOption[a].delegatorsCount)+" Delegators ",1)):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.votersForOption.voters,(e=>((0,o.wg)(),(0,o.j4)(oe,{balance:e.stake,account:e.account,delegators:e.delegators,"no-sum":!0,key:e.account},null,8,["balance","account","delegators"])))),128))],512),[[s.F8,null!=r.votersForOption.id&&r.votersForOption.id===a]])])))),128))])):(0,o.kq)("",!0)]),M,(0,o._)("div",K,[(0,o._)("div",G,[(0,o.Uk)(" open source at "),r.showCopyNoticeVerify?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("a",{key:0,href:"https://github.com/aeternity/aepp-governance/",onClick:t[3]||(t[3]=(0,s.iM)((e=>u.openLink("verify","https://github.com/aeternity/aepp-governance/")),["stop","prevent"])),class:"text-primary"},"aeternity/aepp-governance"))]),r.showCopyNoticeVerify?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("a",{key:0,href:"https://github.com/aeternity/aepp-governance/blob/master/docs/how-to-verify-results.md",onClick:t[4]||(t[4]=(0,s.iM)((e=>u.openLink("verify","https://github.com/aeternity/aepp-governance/blob/master/docs/how-to-verify-results.md")),["stop","prevent"])),class:"text-primary opacity-40"},"verify the poll result")),(0,o.Wm)(s.uT,{name:"fade"},{default:(0,o.w5)((()=>[r.showCopyNoticeVerify?((0,o.wg)(),(0,o.iD)("div",J," copied link to clipboard ")):(0,o.kq)("",!0)])),_:1})]),(0,o.Wm)(se,{htmlId:"poll-nav-buttons","cta-text":null===r.voteOption||r.isClosed?null:"Revoke Vote",onCta:u.revokeVote},null,8,["cta-text","onCta"])])):(0,o.kq)("",!0),(0,o.Wm)(le,{error:r.error,onContinue:r.continueFunction},null,8,["error","onContinue"])])}var Q=a(81251),ee=JSON.parse('{"encodedAci":{"contract":{"event":{"variant":[{"Vote":["address","address","int"]},{"RevokeVote":["address","address"]}]},"functions":[{"arguments":[{"name":"metadata","type":"Poll.metadata"},{"name":"vote_options","type":"Poll.vote_option"},{"name":"close_height","type":{"option":["int"]}}],"name":"init","payable":false,"returns":"Poll.state","stateful":false},{"arguments":[{"name":"option","type":"int"}],"name":"vote","payable":false,"returns":{"tuple":[]},"stateful":true},{"arguments":[],"name":"revoke_vote","payable":false,"returns":{"tuple":[]},"stateful":true},{"arguments":[],"name":"get_state","payable":false,"returns":"Poll.state","stateful":false},{"arguments":[],"name":"title","payable":false,"returns":"string","stateful":false},{"arguments":[],"name":"close_height","payable":false,"returns":{"option":["int"]},"stateful":false},{"arguments":[],"name":"metadata","payable":false,"returns":"Poll.metadata","stateful":false},{"arguments":[],"name":"votes","payable":false,"returns":"Poll.votes","stateful":false},{"arguments":[{"name":"author","type":"address"}],"name":"is_author","payable":false,"returns":"bool","stateful":false},{"arguments":[{"name":"voter","type":"address"}],"name":"has_voted","payable":false,"returns":"bool","stateful":false},{"arguments":[],"name":"is_closed","payable":false,"returns":"bool","stateful":false},{"arguments":[{"name":"voter","type":"address"}],"name":"voted_option","payable":false,"returns":{"option":["int"]},"stateful":false},{"arguments":[],"name":"version","payable":false,"returns":"int","stateful":false}],"kind":"contract_main","name":"Poll","payable":false,"state":{"record":[{"name":"metadata","type":"Poll.metadata"},{"name":"vote_options","type":"Poll.vote_option"},{"name":"close_height","type":{"option":["int"]}},{"name":"create_height","type":"int"},{"name":"votes","type":"Poll.votes"},{"name":"author","type":"address"}]},"type_defs":[{"name":"metadata","typedef":{"record":[{"name":"title","type":"string"},{"name":"description","type":"string"},{"name":"link","type":"string"},{"name":"spec_ref","type":{"option":["hash"]}}]},"vars":[]},{"name":"vote_option","typedef":{"map":["int","string"]},"vars":[]},{"name":"votes","typedef":{"map":["address","int"]},"vars":[]}]}},"externalEncodedAci":[{"namespace":{"name":"ListInternal","type_defs":[]}},{"namespace":{"name":"List","type_defs":[]}},{"namespace":{"name":"String","type_defs":[]}}]}'),te=a(10237),ae=a(58572),oe=a(45468),se=a(70794),le=a(94848),ne=a(20164),ie=a(70762);const re={class:"flex justify-between"},ce={key:0},de={class:"text-primary cursor-pointer"},pe={class:"ml-2 my-1"},ue={key:0};function he(e,t,a,s,n,i){const r=(0,o.up)("ae-identity-light"),c=(0,o.up)("AccountTreeLine",!0);return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",re,[(0,o.Wm)(r,{collapsed:!0,address:a.account,balance:"",class:"mx-2",onClick:t[0]||(t[0]=t=>e.$router.push(`/account/${a.account}`))},null,8,["address"]),(0,o._)("div",{onClick:t[1]||(t[1]=e=>n.showSubTree=!n.showSubTree)},[n.totalTreeDepth?((0,o.wg)(),(0,o.iD)("span",ce,[(0,o.Uk)(" ("),(0,o._)("span",de,(0,l.zw)(n.totalTreeDepth)+"D",1),(0,o.Uk)(") ")])):(0,o.kq)("",!0),(0,o._)("span",null,(0,l.zw)(i.toAE(n.totalBalance)),1)])]),(0,o._)("div",pe,[n.showSubTree?((0,o.wg)(),(0,o.iD)("div",ue,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.directDelegators,(e=>((0,o.wg)(),(0,o.j4)(c,{account:e.account,balance:e.balance,delegators:e.delegations,key:e.account},null,8,["account","balance","delegators"])))),128))])):(0,o.kq)("",!0)])])}var ge=a(16395),me={name:"AccountTreeLine",components:{AeIdentityLight:oe.Z},props:["balance","account","delegators","noSum"],data(){return{directDelegators:[],showSubTree:!1,totalTreeDepth:null,totalBalance:null}},methods:{toAE:ge.zx,obtainTotalNumberOfDelegations(e){let t=Object.keys(e);return t.length?t.reduce(((t,a)=>this.obtainTotalNumberOfDelegations(e[a].delegations)+t),t.length):0},obtainTotalBalanceFromDelegations(e){let t=Object.keys(e.delegations);return t.length?t.reduce(((t,a)=>(0,se.Z)(this.obtainTotalBalanceFromDelegations(e.delegations[a])).plus(t)),e.balance):e.balance}},created(){this.directDelegators=Object.keys(this.delegators).map((e=>({account:e,...this.delegators[e]}))),this.totalTreeDepth=this.obtainTotalNumberOfDelegations(this.delegators),this.totalBalance=this.noSum?this.balance:this.obtainTotalBalanceFromDelegations({delegations:this.delegators,balance:this.balance})}},ye=a(83744);const fe=(0,ye.Z)(me,[["render",he]]);var ve=fe,we=a(20640),ke=a.n(we),be=a(11758),Ce=a(7319);const xe={class:"ae-check"},_e=["id","type","name","value","checked","disabled"],De={class:"ae-check-button"};function Se(e,t,a,s,l,n){return(0,o.wg)(),(0,o.iD)("label",xe,[(0,o._)("input",{id:a.id,type:a.type,name:a.name,value:a.value,checked:n.isChecked,disabled:a.disabled,onChange:t[0]||(t[0]=(...e)=>n.change&&n.change(...e))},null,40,_e),(0,o._)("span",De,[(0,o.WI)(e.$slots,"default",{},void 0,!0)])])}var Oe=a(25108),Ae={name:"ae-check",model:{prop:"checked",event:"change"},props:{id:String,name:String,value:{type:[String,Number,Boolean,BigInt],default:void 0},checked:{type:[Array,String,Number,Boolean],default:!1},type:{type:String,default:"checkbox"},disabled:{type:Boolean,default:!1}},computed:{isChecked(){return Array.isArray(this.checked)?this.checked.includes(this.value):this.checked===this.value||!0===this.checked}},methods:{change(e){let t;Oe.log(e),t=void 0===this.value?e.target.checked:"radio"!==this.type&&Array.isArray(this.checked)?e.target.checked?[...this.checked,this.value]:this.checked.filter((e=>e!==this.value)):this.value,this.$emit("change",t)}}};const Te=(0,ye.Z)(Ae,[["render",Se],["__scopeId","data-v-b39c1c74"]]);var Ve=Te,Be=a(25108),Pe={name:"PollPage",components:{HintBubble:be.Z,AccountTreeLine:ve,CriticalErrorOverlay:ie.Z,AccountHeader:ne.Z,BottomButtons:le.Z,AeCheck:Ve,BiggerLoader:ae.Z,AeIdentityLight:oe.Z},data(){return{showLoading:!0,pollId:null,delegateeVote:{},voteOption:null,pollContract:null,pollState:{},pollVotesState:null,pollAddress:null,votersForOption:{},error:null,isClosed:!1,closeBlock:null,showCopyNotice:!1,showCopyNoticeVerify:!1,height:0,continueFunction:()=>{this.error=null}}},setup:()=>({wallet:Q.gU}),computed:{timeDifference(){return 3*(this.pollState.close_height-this.height)*60*1e3},timeDifferenceString(){return(0,ge.$6)(this.timeDifference)},closeBlockTimeString(){return(0,ge.pT)(this.closeBlock.keyBlock.time)}},methods:{formatPercent:ge.T3,toAE:ge.zx,openLink(e,t){let a=t||this.pollState.metadata.link;window.parent===window?window.open(a):(ke()(a),"verify"===e?this.showCopyNoticeVerify=!0:this.showCopyNotice=!0,setTimeout((()=>{"verify"===e?this.showCopyNoticeVerify=!1:this.showCopyNotice=!1}),1500))},async vote(e){this.showLoading=!0,this.voteOption=e;try{await this.pollContract.methods.vote(this.voteOption,{omitUnknown:!0})}catch(t){Be.error(t),this.error="Could not process your vote. Please try again."}try{await this.loadData()}catch(t){Be.error(t),this.showLoading=!1,this.error="Could not process your vote. Please try again."}},async revokeVote(){this.showLoading=!0;try{await this.pollContract.methods.revoke_vote({omitUnknown:!0}),await this.loadData()}catch(e){Be.error(e),this.showLoading=!1,this.error="Could not revoke your vote. Please try again."}},showVoters(e){if(null!=this.votersForOption.id&&this.votersForOption.id===e)return void(this.votersForOption={});if(!this.pollVotesState)return;const t=this.pollVotesState.stakesForOption.find((t=>t.option===e.toString())).votes,a=t.map((e=>({account:e.account,stake:e.stake,delegators:e.delegationTree})));this.votersForOption={id:e,voters:a.sort(((e,t)=>new se.Z(t.stake).comparedTo(new se.Z(e.stake))))}},async loadData(){this.pollId=this.$route.params.id,this.votersForOption={};let e=Promise.resolve();const t=Ce.Z.registry.methods.poll(this.pollId).then((e=>(this.pollAddress=e.decodedResult.poll,this.pollAddress))).catch((e=>{Be.error(e),this.error="Could not fetch poll address.",this.continueFunction=()=>this.$router.push("/")})),a=(async()=>{this.pollContract=await Q.SZ.getContractInstance({aci:ee,contractAddress:await t}),this.pollState=(await this.pollContract.methods.get_state()).decodedResult,this.pollState.vote_options=Array.from(this.pollState.vote_options.entries()).map((([e,t])=>[Number(e),t])),this.isClosed=this.pollState.close_height<=parseInt(await Q.SZ.getHeight());try{this.closeBlock=this.isClosed?await Q.SZ.getGeneration(this.pollState.close_height):null}catch(a){}const e=Array.from(this.pollState.votes.entries()).find((([e])=>e===Q.gU.address));this.voteOption=e?Number(e[1]):null})().catch((e=>{Be.error(e),this.error="Could not fetch poll state.",this.continueFunction=()=>this.$router.push("/")})),o=new te.Z(Q.gU.networkId).votesState(await t).then((e=>{null!==e&&(this.pollVotesState=e,this.delegateeVote=this.pollVotesState.stakesForOption.map((e=>e.votes.find((e=>e.delegators.some((e=>e.delegator===Q.gU.address)))))).find((e=>e))||{})})).catch(Be.error);await Promise.all([e,t,a,o]),Ce.Z.verifyPollContract(await t).then((e=>{e||(this.error="Could not verify poll contract correctness, proceed with caution.",this.continueFunction=()=>{this.error=null})})).catch((e=>{Be.error(e),this.error="Could not verify poll contract correctness, proceed with caution.",this.continueFunction=()=>{this.error=null}})),this.height=await Q.SZ.getHeight(),this.showLoading=!1}},async mounted(){this.eventBus.on("dataChange",this.loadData);try{await this.loadData()}catch(e){Be.error(e),this.error="Could not load poll.",this.continueFunction=()=>{this.$router.push("/")},this.showLoading=!1}},beforeUnmount(){this.eventBus.off("dataChange",this.loadData)}};const Fe=(0,ye.Z)(Pe,[["render",X],["__scopeId","data-v-0dd4ee95"]]);var Le=Fe}}]);
//# sourceMappingURL=poll.3c8284bd.js.map