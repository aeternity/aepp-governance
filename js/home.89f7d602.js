"use strict";(self["webpackChunkgovernance_aepp"]=self["webpackChunkgovernance_aepp"]||[]).push([[177],{86158:function(e,t,i){i.d(t,{Z:function(){return p}});var s=i(66252),a=i(49963),l=i.p+"img/hash_white.8c0a10d1.svg";const o={class:"bg-gray-ae px-6 py-4 w-full text-3xl text-white flex justify-between items-center"},n={class:"flex items-center justify-end"},r={key:0,ref:"inputContainer",class:"relative rounded-full hide-input flex items-center pr-3 pb-1"};function c(e,t,i,c,h,d){return(0,s.wg)(),(0,s.iD)("div",o,[(0,s.WI)(e.$slots,"default",{},void 0,!0),(0,s._)("div",n,[i.showNumberInput?((0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("img",{src:l,class:"h-6 pl-4 pt-1 cursor-pointer",onClick:t[0]||(t[0]=(...e)=>d.showInput&&d.showInput(...e)),alt:"enter id"}),(0,s._)("form",{onSubmit:t[4]||(t[4]=(0,a.iM)(((...e)=>d.submit&&d.submit(...e)),["prevent"]))},[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>h.id=e),ref:"input",type:"number",onInput:t[2]||(t[2]=t=>e.$emit("input",h.id)),class:"text-gray-800 w-full text-2xl outline-none bg-transparent leading-none",onBlur:t[3]||(t[3]=(...e)=>d.onBlur&&d.onBlur(...e))},null,544),[[a.nr,h.id]])],32)],512)):(0,s.kq)("",!0),(0,s._)("div",{class:"w-8 text-2xl h-8 bg-primary rounded-full justify-center flex items-center ml-2 cursor-pointer",onClick:t[5]||(t[5]=(0,a.iM)((e=>d.toggleHelp()),["stop","prevent"])),id:"question-mark-icon"}," ? ")])])}i(57658);var h={name:"BlackHeader",data(){return{extended:!1,id:null,activeTimeout:0}},props:{showNumberInput:{type:Boolean,default:!1}},methods:{submit(){this.$refs.input.blur(),this.$emit("submit",this.id)},onBlur(){this.$refs.inputContainer.classList.add("hide-input-animation"),this.activeTimeout=setTimeout((()=>{this.$refs.inputContainer.classList.remove("show-input","hide-input-animation"),this.extended=!1,this.id=null}),600)},showInput(){this.extended||(this.extended=!0,this.$refs.inputContainer.classList.add("show-input-animation"),this.activeTimeout=setTimeout((()=>{this.$refs.inputContainer.classList.add("show-input"),this.$refs.inputContainer.classList.remove("show-input-animation")}),600),this.$refs.input.focus())},toggleHelp(){"help"!==this.$route.name?this.$router.push("help"):this.$router.go(-1)}},beforeUnmount(){this.activeTimeout&&clearTimeout(this.activeTimeout)}},d=i(83744);const u=(0,d.Z)(h,[["render",c],["__scopeId","data-v-341082cb"]]);var p=u},50811:function(e,t,i){i.d(t,{Z:function(){return E}});i(57658);var s=i(66252),a=i(3577),l=i(35584),o=i.p+"img/check_circle-24px.f471ff21.svg";const n={class:"ae-card cursor-pointer"},r={class:"flex items-center vote-id w-full"},c=(0,s._)("img",{class:"h-6",src:l,alt:"hash"},null,-1),h={class:"text-primary text-2xl leading-none mr-2"},d={class:"text-2xl leading-none break-words max-w-85"},u={key:0,class:"mt-2 flex items-center"},p=(0,s._)("img",{src:o,class:"mb-1",alt:"checkbox"},null,-1),g={class:"pl-1 leading-none text-gray-600"},b={class:"text-gray-500 text-sm mt-1"},m={key:0},v={key:1},w={key:2},f={key:3},k={key:4};function x(e,t,i,l,o,x){const y=(0,s.up)("AeIdentityLight"),T=(0,s.up)("ae-loader");return(0,s.wg)(),(0,s.iD)("div",n,[i.data.delegatee?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"flex bg-gray-200 text-gray-600 text-sm px-4 py-2 rounded-t",onClick:t[0]||(t[0]=t=>e.$router.push(`/account/${i.data.delegatee}`))},[(0,s.Wm)(y,{address:i.data.delegatee,collapsed:!0,balance:""},null,8,["address"]),(0,s.Uk)(" voted with this stake in ")])):(0,s.kq)("",!0),(0,s._)("div",{class:"p-4 pb-2",onClick:t[1]||(t[1]=t=>e.$router.push(`/poll/${i.id}`))},[(0,s._)("div",r,[c,(0,s._)("span",h,(0,a.zw)(i.id),1),(0,s._)("span",d,(0,a.zw)(i.data.title),1)]),i.showVote?((0,s.wg)(),(0,s.iD)("div",u,[p,(0,s.Uk)(),(0,s._)("span",g,(0,a.zw)(i.data.vote),1)])):(0,s.kq)("",!0),(0,s._)("div",b,[o.percentOfTotalSupply?((0,s.wg)(),(0,s.iD)("span",m,(0,a.zw)(o.percentOfTotalSupply)+" stake - ",1)):o.loading?((0,s.wg)(),(0,s.iD)("span",v,[(0,s.Wm)(T),(0,s.Uk)(" stake - ")])):(0,s.kq)("",!0),x.isClosed?((0,s.wg)(),(0,s.iD)("span",w,"closed at "+(0,a.zw)(i.data.close_height)+" (~"+(0,a.zw)(x.absTimeDifferenceString)+" ago)",1)):"bigint"!==typeof i.data.close_height?((0,s.wg)(),(0,s.iD)("span",f,"never closes")):((0,s.wg)(),(0,s.iD)("span",k,"closes in "+(0,a.zw)(x.timeDifferenceString),1))])])])}var y=i(10237),T=i(45468),_=i(81251);const C={class:"ae-loader"};function O(e,t,i,a,l,o){return(0,s.wg)(),(0,s.iD)("span",C)}var P={name:"ae-loader"},D=i(83744);const I=(0,D.Z)(P,[["render",O],["__scopeId","data-v-430febc9"]]);var S=I,$=i(16395),L=i(25108),N={components:{AeLoader:S,AeIdentityLight:T.Z},data(){return{loading:!0,percentOfTotalSupply:null,voteCount:null,height:0}},props:{id:{type:Number},data:{type:Object},showVote:{type:Boolean,default:!1}},computed:{isClosed(){return Number(this.data.close_height)<this.height},timeDifference(){return 3*(Number(this.data.close_height)-this.height)*60*1e3},timeDifferenceString(){return(0,$.$6)(this.timeDifference)},absTimeDifferenceString(){return(0,$.$6)(Math.abs(this.timeDifference))}},async mounted(){new y.Z(_.gU.networkId).pollOverview(this.data.poll).then((e=>{null!==e&&(this.percentOfTotalSupply=e.percentOfTotalSupply?(0,$.T3)(e.percentOfTotalSupply,2):null,this.voteCount=e.voteCount),this.loading=!1})).catch((e=>{L.error(e),this.loading=!1})),this.height=await _.SZ.getHeight()}};const B=(0,D.Z)(N,[["render",x]]);var E=B},83538:function(e,t,i){i.r(t),i.d(t,{default:function(){return Z}});var s=i(66252),a=i(49963),l=i(3577);const o=e=>((0,s.dD)("data-v-74600ac9"),e=e(),(0,s.Cn)(),e),n={class:"overlay-loader"},r={class:"fixed w-full top-0 max-w-desktop"},c={class:"flex bg-gray-ae text-gray-200",id:"home-tab-switcher"},h=o((()=>(0,s._)("span",{class:"cursor-pointer inline-block"},"HOT",-1))),d=[h],u=o((()=>(0,s._)("span",{class:"cursor-pointer inline-block"},"CLOSING",-1))),p=[u],g=o((()=>(0,s._)("span",{class:"cursor-pointer inline-block"},"STAKE",-1))),b=[g],m=o((()=>(0,s._)("span",{class:"cursor-pointer inline-block"},"NEW",-1))),v=[m],w=o((()=>(0,s._)("span",{class:"cursor-pointer inline-block"},"CLOSED",-1))),f=[w],k={class:"mt-32",id:"home-poll-list"},x={key:0,class:"text-gray-500 text-xl text-center my-8"};function y(e,t,i,o,h,u){const g=(0,s.up)("BiggerLoader"),m=(0,s.up)("BlackHeader"),w=(0,s.up)("PollListing"),y=(0,s.up)("BottomButtons"),T=(0,s.up)("CriticalErrorOverlay");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s.wy)((0,s._)("div",n,[(0,s.Wm)(g)],512),[[a.F8,h.showLoading&&!h.error]]),(0,s._)("div",r,[(0,s.Wm)(m,{"show-number-input":!0,onSubmit:(0,a.iM)(u.showPoll,["self"]),onInput:u.handleIdInput},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(h.activeTab)+" Polls ",1)])),_:1},8,["onSubmit","onInput"]),(0,s._)("div",c,[h.pollOrdering?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,l.C_)([{active:"hot"===h.activeTab},"tab flex-1 text-center pb-2 relative"]),onClick:t[0]||(t[0]=e=>u.switchTab("hot"))},d,2)):(0,s.kq)("",!0),(0,s._)("div",{class:(0,l.C_)([{active:"closing"===h.activeTab},"tab flex-1 text-center pb-2 relative"]),onClick:t[1]||(t[1]=e=>u.switchTab("closing"))},p,2),h.pollOrdering?((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,l.C_)([{active:"stake"===h.activeTab},"tab flex-1 text-center pb-2 relative"]),onClick:t[2]||(t[2]=e=>u.switchTab("stake"))},b,2)):(0,s.kq)("",!0),(0,s._)("div",{class:(0,l.C_)([{active:"new"===h.activeTab},"tab flex-1 text-center pb-2 relative"]),onClick:t[3]||(t[3]=e=>u.switchTab("new"))},v,2),(0,s._)("div",{class:(0,l.C_)([{active:"closed"===h.activeTab},"tab flex-1 text-center pb-2 relative"]),onClick:t[4]||(t[4]=e=>u.switchTab("closed"))},f,2)])]),(0,s._)("div",k,[(0,s.Wm)(a.uT,{name:"fade"},{default:(0,s.w5)((()=>[(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"mx-4 mt-6",key:h.activeTab},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.polls,(([e,t])=>((0,s.wg)(),(0,s.iD)("div",{class:"my-2",key:e},[(0,s.Wm)(w,{id:Number(e),data:t},null,8,["id","data"])])))),128))])),[[a.F8,h.polls]])])),_:1}),h.polls.length||h.showLoading?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",x," Could not find any polls. "))]),h.showSearch?((0,s.wg)(),(0,s.j4)(y,{key:0,htmlId:"home-nav-buttons",onSearch:u.filterPolls,"search-bar":!0},null,8,["onSearch"])):((0,s.wg)(),(0,s.j4)(y,{key:1,htmlId:"home-nav-buttons",onCta:t[5]||(t[5]=e=>u.showPoll(h.pollId)),"cta-text":"Show Poll"})),(0,s.Wm)(T,{error:h.error,onContinue:t[6]||(t[6]=e=>h.error=null)},null,8,["error"])])}i(57658);var T=i(81251),_=i(10237),C=i(58572),O=i(50811),P=i(94848),D=i(86158),I=i(70762),S=i(70794),$=i(7319),L=i(25108),N={name:"HomePage",components:{BlackHeader:D.Z,BottomButtons:P.Z,PollListing:O.Z,BiggerLoader:C.Z,CriticalErrorOverlay:I.Z},data(){return{error:null,showLoading:!0,activeTab:null,availableTabs:["hot","closing","stake","new","closed"],pollOverview:[],polls:[],allPolls:[],closedPolls:[],activePolls:[],pollOrdering:null,showSearch:!0,pollId:null,startPosition:{x:null,y:null}}},watch:{"$route.query.tab"(){this.activeTab=this.$route.query.tab,this.showLoading=!0,this.updateTabView(),this.showLoading=!1}},props:["resetView"],methods:{handleIdInput(e){e&&(this.showSearch=!1,this.pollId=e)},showPoll(e){this.allPolls.find((t=>t[0]===BigInt(e)))?this.$router.push(`/poll/${e}`):this.error=`Could not find poll with id "${e}".`},switchTab(e){this.activeTab!==e&&this.$router.push({query:{tab:e}})},updateTabView(){switch(this.resetView(),this.activeTab){case"hot":this.polls=this.activePolls.filter((([e])=>this.pollOrdering.ordering.includes(Number(e)))).sort(((e,t)=>this.pollOrdering.ordering.indexOf(Number(e[0]))-this.pollOrdering.ordering.indexOf(Number(t[0]))));break;case"stake":const e=this.pollOrdering.data.sort(((e,t)=>new S.Z(t.totalStake).comparedTo(e.totalStake))).map((e=>e.id));this.polls=this.activePolls.sort(((t,i)=>e.indexOf(Number(t[0]))-e.indexOf(Number(i[0]))));break;case"closing":this.polls=this.activePolls.filter((([,e])=>e.close_height)).sort(((e,t)=>e[1].close_height||t[1].close_height?e[1].close_height&&t[1].close_height?Number(e[1].close_height)-Number(t[1].close_height):1:0));break;case"new":this.polls=this.activePolls.sort(((e,t)=>Number(t[0])-Number(e[0])));break;case"closed":this.polls=this.closedPolls.sort(((e,t)=>Number(t[1].close_height)-Number(e[1].close_height)));break}},filterPolls(e){this.updateTabView(),/^\d+$/.test(e)?this.polls=this.polls.filter((t=>t[0]===parseInt(e))):this.polls=this.polls.filter((t=>t[1].title.toLowerCase().indexOf(e.toLowerCase())>-1))},touchStartEvent(e){this.startPosition={x:e.touches[0].clientX,y:e.touches[0].clientY}},touchEndEvent(e){const t={x:e.changedTouches[e.changedTouches.length-1].clientX-this.startPosition.x,y:e.changedTouches[e.changedTouches.length-1].clientY-this.startPosition.y};Math.abs(t.x)>Math.abs(t.y)&&Math.abs(t.x)>100&&this.swipeTab(t.x),this.startPosition={x:null,y:null}},swipeTab(e){const t=this.availableTabs.indexOf(this.activeTab);let i=e>0?-1:1;t+i<0&&(i=4),this.switchTab(this.availableTabs[(t+i)%this.availableTabs.length])},async loadData(){T.gU.address&&"ae_uat"===T.gU.networkId&&T.gU.balance&&Number(T.gU.balance)<5&&await fetch(`https://testnet.faucet.aepps.com/account/${T.gU.address}`,{headers:{"content-type":"application/x-www-form-urlencoded"},method:"POST"}).catch(L.error);const e=$.Z.polls().catch((e=>{L.error(e),this.error="Could not fetch polls."})),t=new _.Z(T.gU.networkId).pollOrdering(!1).catch(L.error),[i,s]=await Promise.all([e,t]);if(this.pollOrdering=s,this.allPolls=i.filter((([,e])=>e.title.length<=50)),this.allPolls){let e=BigInt(await T.SZ.getHeight());this.closedPolls=this.allPolls.filter((([,e])=>e.is_listed)).filter((([,t])=>t.close_height&&t.close_height<=e)),this.activePolls=this.allPolls.filter((([,e])=>e.is_listed)).filter((([,t])=>!t.close_height||t.close_height>e))}this.activeTab||(this.activeTab=this.pollOrdering?"hot":"new"),"stake"!==this.activeTab&&"hot"!==this.activeTab||this.pollOrdering||(this.activeTab="new"),this.pollOrdering||(this.availableTabs=["closing","new","closed"]),this.updateTabView(),document.addEventListener("touchstart",this.touchStartEvent,!1),document.addEventListener("touchend",this.touchEndEvent,!1),this.showLoading=!1}},async mounted(){this.eventBus.on("dataChange",this.loadData),await this.loadData()},created(){this.activeTab=this.$route.query.tab?this.$route.query.tab:null},beforeUnmount(){document.removeEventListener("touchstart",this.touchStartEvent,!1),document.removeEventListener("touchend",this.touchEndEvent,!1),this.eventBus.off("dataChange",this.loadData)}},B=i(83744);const E=(0,B.Z)(N,[["render",y],["__scopeId","data-v-74600ac9"]]);var Z=E}}]);
//# sourceMappingURL=home.89f7d602.js.map